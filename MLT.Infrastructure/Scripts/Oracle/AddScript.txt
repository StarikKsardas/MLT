--------------------------------------------------------------------------
-- Play this script in DACTOCREATOR@DACTO25 to make it look like DACTOCREATOR@BEQ-LOCAL
--
-- Please review the script before using it to make sure it won't
-- cause any unacceptable data loss.
--
-- DACTOCREATOR@DACTO25 Schema Extracted by User DACTOCREATOR 
-- DACTOCREATOR@BEQ-LOCAL Schema Extracted by User DACTOCREATOR 
--------------------------------------------------------------------------
-- "Set define off" turns off substitution variables
Set define off;

CREATE SEQUENCE DACTOCREATOR.ANSWER_MOBILE_SQ
  START WITH 85
  MAXVALUE 999999999
  MINVALUE 1
  CYCLE
  NOCACHE
  ORDER;

CREATE SEQUENCE DACTOCREATOR.DACTO_WEB_MOBLIE_LOG_SQ
  START WITH 3096
  MAXVALUE 999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  ORDER;

CREATE SEQUENCE DACTOCREATOR.WEB_USER_SQ
  START WITH 41
  MAXVALUE 999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  ORDER;

CREATE TABLE DACTOCREATOR.WEB_ANSWER
(
  QUERY_ID    NUMBER(8)                         NOT NULL,
  USER_ID     NUMBER(8)                         NOT NULL,
  DS_ID       NUMBER(8)                         NOT NULL,
  PLACE_CODE  NUMBER(11)                        NOT NULL,
  ABR_PLACE   VARCHAR2(255 BYTE)                NOT NULL,
  REG_DATE    DATE                              NOT NULL,
  STATUS      VARCHAR2(255 BYTE)                NOT NULL
)
TABLESPACE USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          80K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;

CREATE TABLE DACTOCREATOR.WEB_USER
(
  USR_ID          NUMBER(8)                     NOT NULL,
  PLACE_CODE      NUMBER(11)                    NOT NULL,
  ABR_PLACE       VARCHAR2(255 BYTE)            NOT NULL,
  LASTNAME        VARCHAR2(255 BYTE)            NOT NULL,
  FIRSTNAME       VARCHAR2(255 BYTE)            NOT NULL,
  MIDNAME         VARCHAR2(255 BYTE)            NOT NULL,
  PHONE           VARCHAR2(255 BYTE)            NOT NULL,
  LOGIN           VARCHAR2(255 BYTE)            NOT NULL,
  PASS            VARCHAR2(255 BYTE)            NOT NULL,
  REG_DATE        DATE                          NOT NULL,
  PLACE_CODE_LEX  VARCHAR2(1000 BYTE)           NOT NULL,
  PHONE_ID        VARCHAR2(50 BYTE)             NOT NULL,
  UPDATE_DATE     DATE                          NOT NULL
)
TABLESPACE USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          80K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;

CREATE UNIQUE INDEX DACTOCREATOR.XWEB_USER_ID ON DACTOCREATOR.WEB_USER
(LOGIN, PHONE_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          80K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

CREATE UNIQUE INDEX DACTOCREATOR.WEB_USER_ID_PK ON DACTOCREATOR.WEB_USER
(USR_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          80K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

ALTER TABLE DACTOCREATOR.WEB_USER
 ADD CONSTRAINT WEB_USER_ID_PK
  PRIMARY KEY
  (USR_ID)
  USING INDEX DACTOCREATOR.WEB_USER_ID_PK;

CREATE TABLE DACTOCREATOR.WEB_MOBILE_LOG
(
  ID            NUMBER(12),
  MACHINENAME   VARCHAR2(50 BYTE),
  LOGGED        DATE,
  LEVELERR      VARCHAR2(50 BYTE),
  MESSAGE       VARCHAR2(2000 BYTE),
  LOGGER        VARCHAR2(250 BYTE),
  CALLSITE      VARCHAR2(2000 BYTE),
  EXCEPTIONERR  VARCHAR2(2000 BYTE)
)
TABLESPACE DACTOALL
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          80K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;

CREATE TABLE DACTOCREATOR.WEB_ANSWER_MOBILE
(
  ID            NUMBER(9)                       NOT NULL,
  DS_ID         NUMBER(9)                       NOT NULL,
  QUERY_ID      NUMBER(9)                       NOT NULL,
  LOCAL_STATUS  NUMBER(8)                       NOT NULL
)
TABLESPACE USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          80K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;

CREATE UNIQUE INDEX DACTOCREATOR.WEB_ANSWER_MOBILE_PK ON DACTOCREATOR.WEB_ANSWER_MOBILE
(ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          80K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

CREATE UNIQUE INDEX DACTOCREATOR.XWEB_ANSWER_MOBILE ON DACTOCREATOR.WEB_ANSWER_MOBILE
(DS_ID, QUERY_ID)
LOGGING
TABLESPACE DACTOINDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          80K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

ALTER TABLE DACTOCREATOR.WEB_ANSWER_MOBILE
 ADD CONSTRAINT WEB_ANSWER_MOBILE_PK
  PRIMARY KEY
  (ID)
  USING INDEX DACTOCREATOR.WEB_ANSWER_MOBILE_PK;

CREATE OR REPLACE PROCEDURE DACTOCREATOR.GET_NEXT_WEB_USR_ID ( NEXT_WEB_USR_ID IN OUT NUMBER) IS
BEGIN

   SELECT DACTOCREATOR.WEB_USER_SQ.NEXTVAL INTO NEXT_WEB_USR_ID FROM DUAL;

END;
/

SHOW ERRORS;

CREATE OR REPLACE TRIGGER DACTOCREATOR.WEB_MOBILE_PK_AUTO_INC
BEFORE INSERT ON DACTOCREATOR.WEB_MOBILE_LOG 
FOR EACH ROW
BEGIN
IF INSERTING THEN
IF :NEW."ID" IS NULL THEN
SELECT DACTOCREATOR.DACTO_WEB_MOBLIE_LOG_SQ.NEXTVAL INTO :NEW.ID FROM DUAL;
END IF; 
END IF;
END;
/
SHOW ERRORS;

CREATE OR REPLACE TRIGGER DACTOCREATOR.WEB_ANSWER_MOBILE_PK_AUTO_INC
BEFORE INSERT ON DACTOCREATOR.WEB_ANSWER_MOBILE 
FOR EACH ROW
BEGIN
IF INSERTING THEN
IF :NEW."ID" IS NULL THEN
SELECT DACTOCREATOR.ANSWER_MOBILE_SQ.NEXTVAL INTO :NEW.ID FROM DUAL;
END IF; 
END IF;
END;
/
SHOW ERRORS;

CREATE OR REPLACE TRIGGER DACTOCREATOR.WEB_USER_PK_AUTO_INC
BEFORE INSERT ON DACTOCREATOR.WEB_USER
FOR EACH ROW
BEGIN
IF INSERTING THEN
IF :NEW."USR_ID" IS NULL THEN
SELECT DACTOCREATOR.WEB_USER_SQ.NEXTVAL INTO :NEW.USR_ID FROM DUAL;
END IF; 
END IF;
END;
/
SHOW ERRORS;

ALTER TABLE DACTOCREATOR.WEB_ANSWER_MOBILE
 ADD CONSTRAINT R_ANSWER_MOBILE_DESCR_SL 
  FOREIGN KEY (DS_ID) 
  REFERENCES DACTOCREATOR.DACTO_DESCR_SL (DS_ID)
  ON DELETE CASCADE;

ALTER TABLE DACTOCREATOR.WEB_ANSWER_MOBILE
 ADD CONSTRAINT R_ANSWER_MOBILE_KL_STATUS 
  FOREIGN KEY (LOCAL_STATUS) 
  REFERENCES DACTOCREATOR.DACTO_KL_QUERY_STATUS (LOCAL_STATUS)
  ON DELETE CASCADE;